# éªŒè¯ç é‚®ä»¶ç›‘æ§ç³»ç»Ÿ
è¿™æ˜¯ä¸€ä¸ªåŸºäº Java çš„ Spring Boot é¡¹ç›®ï¼Œä¸»è¦ç”¨äºç›‘å¬é‚®ç®±ä¸­çš„éªŒè¯ç é‚®ä»¶ï¼Œå¹¶é€šè¿‡é’‰é’‰æœºå™¨äººå°†éªŒè¯ç å‘é€åˆ°æŒ‡å®šç¾¤ç»„ã€‚è¯¥é¡¹ç›®æ”¯æŒå¤šçº¿ç¨‹ç›‘æ§å¤šä¸ªé‚®ç®±è´¦å·ï¼Œå¹¶å…·å¤‡è‡ªåŠ¨é‡è¿ã€å®šæ—¶ä¿æŒè¿æ¥æ´»è·ƒç­‰åŠŸèƒ½ã€‚

# ç›®å½•ç»“æ„
.
â”œâ”€â”€ main
â”‚   â”œâ”€â”€ java
â”‚   â”‚   â””â”€â”€ com
â”‚   â”‚       â””â”€â”€ maijin
â”‚   â”‚           â””â”€â”€ captcha
â”‚   â”‚               â”œâ”€â”€ common                  # å…¬å…±å¼‚å¸¸ç±»
â”‚   â”‚               â”‚   â””â”€â”€ ServiceException.java
â”‚   â”‚               â”œâ”€â”€ component               # ç»„ä»¶æ¨¡å—
â”‚   â”‚               â”‚   â”œâ”€â”€ EmailMonitorStarter.java    # å¤šçº¿ç¨‹å¯åŠ¨é‚®ä»¶ç›‘æ§ä»»åŠ¡
â”‚   â”‚               â”‚   â””â”€â”€ ProfileService.java         # ç¯å¢ƒé…ç½®æœåŠ¡
â”‚   â”‚               â”œâ”€â”€ config                  # é…ç½®æ¨¡å—
â”‚   â”‚               â”‚   â”œâ”€â”€ AsyncConfig.java    # å¼‚æ­¥ä»»åŠ¡é…ç½®
â”‚   â”‚               â”‚   â””â”€â”€ EmailConfig.java    # é‚®ä»¶è´¦æˆ·é…ç½®ä¿¡æ¯
â”‚   â”‚               â”œâ”€â”€ controller              # æ§åˆ¶å™¨æ¨¡å—
â”‚   â”‚               â”‚   â””â”€â”€ AliEmailController.java     # Web API æ¥å£
â”‚   â”‚               â”œâ”€â”€ domain                  # æ•°æ®æ¨¡å‹
â”‚   â”‚               â”‚   â””â”€â”€ Account.java        # ç”¨æˆ·è´¦å·å®ä½“ç±»
â”‚   â”‚               â”œâ”€â”€ service                 # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚               â”‚   â”œâ”€â”€ AliEmailMonitor.java      # é˜¿é‡Œäº‘é‚®ç®±ç›‘å¬å™¨ï¼ˆä¸»å®ç°ï¼‰
â”‚   â”‚               â”‚   â”œâ”€â”€ AliEmailMonitor2.java     # é˜¿é‡Œäº‘é‚®ç®±ç›‘å¬å™¨ï¼ˆå¤‡ç”¨å®ç°ï¼‰
â”‚   â”‚               â”‚   â””â”€â”€ MultiEmailMonitor.java    # å¤šé‚®ç®±ç»Ÿä¸€è½¬å‘ç›‘å¬å™¨
â”‚   â”‚               â”œâ”€â”€ utils                   # å·¥å…·ç±»æ¨¡å—
â”‚   â”‚               â”‚   â”œâ”€â”€ dingtalk            # é’‰é’‰æ¶ˆæ¯æ¨é€ç›¸å…³å·¥å…·
â”‚   â”‚               â”‚   â”‚   â”œâ”€â”€ client
â”‚   â”‚               â”‚   â”‚   â”‚   â””â”€â”€ DingTalkRobotClient.java  # é’‰é’‰æœºå™¨äººå®¢æˆ·ç«¯
â”‚   â”‚               â”‚   â”‚   â”œâ”€â”€ entity          # æ¶ˆæ¯å®ä½“ç±»
â”‚   â”‚               â”‚   â”‚   â”‚   â”œâ”€â”€ BaseMessage.java
â”‚   â”‚               â”‚   â”‚   â”‚   â”œâ”€â”€ LinkMessage.java
â”‚   â”‚               â”‚   â”‚   â”‚   â”œâ”€â”€ MarkdownMessage.java
â”‚   â”‚               â”‚   â”‚   â”‚   â””â”€â”€ TextMessage.java
â”‚   â”‚               â”‚   â”‚   â”œâ”€â”€ enums           # æ¶ˆæ¯ç±»å‹æšä¸¾
â”‚   â”‚               â”‚   â”‚   â”‚   â””â”€â”€ DingTalkMsgEnum.java
â”‚   â”‚               â”‚   â”‚   â”œâ”€â”€ response        # å“åº”å¯¹è±¡
â”‚   â”‚               â”‚   â”‚   â”‚   â””â”€â”€ DingTalkResponse.java
â”‚   â”‚               â”‚   â”‚   â””â”€â”€ DingTalkConfig.java   # é’‰é’‰é…ç½®ç±»
â”‚   â”‚               â”‚   â”œâ”€â”€ gmail               # Gmail ç¤ºä¾‹ç›‘å¬å™¨
â”‚   â”‚               â”‚   â”‚   â””â”€â”€ GmailMonitor.java
â”‚   â”‚               â”‚   â””â”€â”€ ExtractVC.java      # éªŒè¯ç æå–å·¥å…·ç±»
â”‚   â”‚               â””â”€â”€ CaptchaApplication.java # å¯åŠ¨ç±»
â”‚   â””â”€â”€ resources
â”‚       â”œâ”€â”€ application.yml                     # åº”ç”¨é…ç½®æ–‡ä»¶
â”‚       â””â”€â”€ log4j2.xml                          # æ—¥å¿—é…ç½®æ–‡ä»¶
â””â”€â”€ test
    â””â”€â”€ java
        â””â”€â”€ com
            â””â”€â”€ maijin
                â””â”€â”€ captcha
                    â””â”€â”€ CaptchaApplicationTests.java  # å•å…ƒæµ‹è¯•
## ä¸»è¦åŠŸèƒ½æ¨¡å—è¯´æ˜
ğŸ“¦ common/ServiceException.java
è‡ªå®šä¹‰è¿è¡Œæ—¶å¼‚å¸¸ç±»ï¼Œç”¨äºå°è£…å…¨å±€å¼‚å¸¸ä¿¡æ¯ã€‚
æ”¯æŒæºå¸¦é”™è¯¯ä¿¡æ¯ä¸å¼‚å¸¸å †æ ˆã€‚
 
# âš™ï¸ component/EmailMonitorStarter.java
ä½¿ç”¨ TaskExecutor å¯åŠ¨å¤šä¸ªé‚®ç®±ç›‘å¬ä»»åŠ¡ã€‚
å¯åŒæ—¶ç›‘æ§å¤šä¸ªé˜¿é‡Œäº‘é‚®ç®±è´¦å·ï¼Œæ¯ä¸ªè´¦å·ç‹¬ç«‹çº¿ç¨‹è¿è¡Œã€‚
 
# ğŸŒ config/AsyncConfig.java
é…ç½®å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå™¨ï¼Œä½¿ç”¨ ThreadPoolTaskExecutor æä¾›çº¿ç¨‹æ± æ”¯æŒã€‚
æœ€å¤§æ”¯æŒ 50 ä¸ªå¹¶å‘çº¿ç¨‹ã€‚
 
# ğŸ“¨ controller/AliEmailController.java
æä¾›ä¸¤ä¸ª RESTful æ¥å£ï¼š
/aliemail/startï¼šå¯åŠ¨é‚®ç®±éªŒè¯ç ç›‘å¬
/aliemail/startemï¼šå¯åŠ¨å¤šé‚®ç®±ç»Ÿä¸€è½¬å‘ç›‘å¬
 
# ğŸ§  service/AliEmailMonitor.java
æ ¸å¿ƒé‚®ç®±ç›‘å¬ç±»ï¼Œä½¿ç”¨ IMAP åè®®ç›‘å¬é˜¿é‡Œäº‘é‚®ç®±ã€‚
æ”¯æŒ IDLE æ¨¡å¼å®æ—¶ç›‘å¬æ–°é‚®ä»¶ã€‚
è‡ªåŠ¨å¤„ç†è¿æ¥ä¸­æ–­å¹¶å°è¯•é‡è¿ã€‚
è§£æé‚®ä»¶å†…å®¹ï¼Œæå–éªŒè¯ç å¹¶é€šè¿‡é’‰é’‰é€šçŸ¥ã€‚
 
# ğŸ“² utils/dingtalk/*
é›†æˆé’‰é’‰æœºå™¨äººï¼Œæ”¯æŒå¤šç§æ¶ˆæ¯æ ¼å¼ï¼ˆMarkdownã€æ–‡æœ¬ã€é“¾æ¥ï¼‰ã€‚
åŒ…å«æ¶ˆæ¯å®ä½“ã€å“åº”å°è£…ã€é…ç½®åŠ è½½ç­‰ç»„ä»¶ã€‚
 
# ğŸ” utils/ExtractVC.java
ä» HTML æˆ–æ–‡æœ¬é‚®ä»¶ä¸­æå–å…­ä½æ•°å­—éªŒè¯ç ã€‚
æ”¯æŒ <span>ã€<td>ã€<strong> æ ‡ç­¾åŒ…è£¹çš„å†…å®¹è§£æã€‚
 
# ğŸ“§ service/MultiEmailMonitor.java
å¤šé‚®ç®±ç»Ÿä¸€ç›‘å¬æ¨¡å—ã€‚
æ‰€æœ‰é‚®ç®±æ”¶åˆ°éªŒè¯ç åç»Ÿä¸€è½¬å‘è‡³ä¸€ä¸ªç›®æ ‡é‚®ç®±ã€‚
æ”¯æŒ SMTP è½¬å‘é‚®ä»¶ã€‚
 
# ğŸ“„ resources/application.yml
æ•°æ®åº“é…ç½®ã€æœåŠ¡å™¨ç«¯å£ã€MyBatis Plus é…ç½®ç­‰åŸºç¡€è®¾ç½®ã€‚
 
 
# ğŸ§ª test/CaptchaApplicationTests.java
Spring Boot å•å…ƒæµ‹è¯•å…¥å£ï¼ŒéªŒè¯åº”ç”¨ä¸Šä¸‹æ–‡æ˜¯å¦æ­£å¸¸åŠ è½½ã€‚
 
# å¦‚ä½•è¿è¡Œ
ä¿®æ”¹ application.yml ä¸­æ•°æ®åº“é…ç½®ã€‚
åœ¨ AliEmailMonitor.java å’Œ MultiEmailMonitor.java ä¸­å¡«å†™é‚®ç®±è´¦å·å’Œå¯†ç ã€‚
é…ç½®é’‰é’‰æœºå™¨äººçš„ accessTokenã€‚
å¯åŠ¨ Spring Boot åº”ç”¨ã€‚
è®¿é—®æ¥å£ /aliemail/start å¼€å§‹ç›‘å¬éªŒè¯ç é‚®ä»¶ã€‚

JDK 17+
Maven 3.8+
MySQL æ•°æ®åº“ï¼ˆæ ¹æ® application.yml é…ç½®ï¼‰

## âš ï¸ å…è´£å£°æ˜

-   æœ¬å·¥å…·ä»…ä¾›å­¦ä¹ å’ŒæŠ€æœ¯ç ”ç©¶ä½¿ç”¨ã€‚
-   è¯·å‹¿ç”¨äºä»»ä½•å•†ä¸šæˆ–éæ³•ç”¨é€”ã€‚
-   ç”¨æˆ·éœ€è‡ªè¡Œæ‰¿æ‹…å› ä½¿ç”¨æœ¬å·¥å…·è€Œäº§ç”Ÿçš„ä¸€åˆ‡é£é™©å’Œè´£ä»»ã€‚